const mongoose = require('mongoose');
require('dotenv').config();

const Permission = require('../models/Permission');

const connectDB = async () => {
    try {
        // 对密码进行URL编码，处理特殊字符
        const encodedPassword = encodeURIComponent(process.env.DB_PASSWORD);
        const mongoURI = `mongodb://${process.env.DB_USER}:${encodedPassword}@${process.env.DB_HOST}:${process.env.DB_PORT}/${process.env.DB_NAME}?authSource=admin`;

        await mongoose.connect(mongoURI, {
            useNewUrlParser: true,
            useUnifiedTopology: true,
        });

        console.log('MongoDB 连接成功');
    } catch (error) {
        console.error('MongoDB 连接失败:', error);
        process.exit(1);
    }
};

// 更新权限图标
const updatePermissionIcons = async () => {
    console.log('开始更新权限图标...');

    // 定义权限图标映射
    const iconMap = {
        'Home': ['M192 299.946667a33.408 33.408 0 0 1 34.133333 54.741333l-30.037333 22.272a62.72 62.72 0 0 0-22.613333 47.872v339.456a100.906667 100.906667 0 0 0 100.522666 100.181333h170.666667v0.725334a33.408 33.408 0 1 1 0 66.773333h-170.666667A167.68 167.68 0 0 1 106.666667 764.672V424.832a129.109333 129.109333 0 0 1 50.090666-100.181333l30.805334-23.04zM410.496 119.466667a153.984 153.984 0 0 1 192.896 0l256.426667 204.416A130.218667 130.218667 0 0 1 908.373333 424.106667l-0.341333 340.224a167.338667 167.338667 0 0 1-167.338667 167.338666h-74.24c-44.714667 0-81.024-36.181333-81.237333-80.896v-153.6l-0.341333-3.84a21.546667 21.546667 0 0 0-21.162667-17.664h-111.317333a21.504 21.504 0 0 0-21.504 21.888v58.624a33.408 33.408 0 1 1-66.773334 0v-58.624a88.661333 88.661333 0 0 1 88.661334-88.661333h111.317333a88.661333 88.661333 0 0 1 88.32 88.661333v153.216c0 7.808 6.272 14.08 14.08 14.08h76.032a100.181333 100.181333 0 0 0 100.181333-100.138666V424.832a62.72 62.72 0 0 0-23.722666-48.213333l-256.384-204.458667a87.552 87.552 0 0 0-111.317334 0l-82.346666 61.568a34.048 34.048 0 1 1-39.68-55.253333z'],
        'Project': ['M778.976 526.272l-328.928 0c-26.88 0-48.576-21.664-48.576-48.544s21.728-48.544 48.576-48.544l328.896 0c26.88 0 48.512 21.728 48.512 48.544 0.032 26.88-21.824 48.544-48.48 48.544l0 0 0 0zM778.976 718.56l-328.928 0c-26.88 0-48.576-21.728-48.576-48.576 0-26.88 21.728-48.512 48.576-48.512l328.896 0c26.88 0 48.512 21.728 48.512 48.512 0.032 26.848-21.824 48.576-48.48 48.576l0 0 0 0zM1002.208 877.28l0-614.304c0-74.656-68-67.616-68-67.616s-405.92 0.416-384.352 0c-23.136 0.416-34.848-12.192-34.848-12.192s-16.128-27.936-45.28-71.712c-30.368-46.112-65.76-38.688-65.76-38.688l-298.944 0c-82.848 0-83.68 79.776-83.68 79.776l0 720.8c0 88.864 67.168 77.92 67.168 77.92l851.872 0c71.904 0.032 61.856-73.984 61.856-73.984l0 0 0 0 0 0 0 0zM941.184 840.896c0 27.488-22.112 49.6-49.632 49.6l-759.648 0c-27.488 0-49.6-22.112-49.6-49.6l0-514.272c0-27.488 22.112-49.632 49.6-49.632l759.648 0c27.488 0 49.632 22.112 49.632 49.632l0 514.272zM217.696 477.728c0 28.672 23.232 51.872 51.872 51.872s51.872-23.2 51.872-51.872c0-28.64-23.232-51.872-51.872-51.872s-51.872 23.2-51.872 51.872l0 0 0 0zM217.696 669.92c0 28.704 23.232 51.936 51.872 51.936s51.872-23.232 51.872-51.936c0-28.64-23.232-51.872-51.872-51.872s-51.872 23.264-51.872 51.872l0 0 0 0z'],
        'Staff': ['M774 406q58 30 92 88t30 127q0 12-9.5 22.5t-21 10.5q-11.5 0-21-10.5T835 621q0-46-21.5-85t-58-62.5Q719 450 677 450q-13 0-22-8.5t-9-24q0-15.5 9-24.5t22-9q30 0 53-24.5t23-57.5q0-33-23-58t-53-25q-12 0-21.5-10t-9.5-22.5q0-12.5 9.5-23T677 153q37 0 68.5 20t50 54q18.5 34 18.5 75 0 29-10.5 56T774 406z m-228 14q57 22 100 63.5t66 95Q735 632 735 691q0 13-10.5 23.5T701 725q-13 0-23.5-10.5T667 691q0-61-31.5-113T550 495.5Q496 465 431.5 465T313 495.5Q259 526 228 578t-31 113q0 13-11 23.5T162 725q-13 0-23.5-10.5T128 691q0-59 23.5-112.5t66-95Q260 442 317 419q-43-29-67.5-74T225 250q0-56 28-102.5t75-74Q375 46 431.5 46t104 27.5q47.5 27.5 75 74T638 250q0 50-24 95t-68 74v1zM432 114q-37 0-68.5 18.5t-50.5 50Q294 214 294 250t18 67.5q18 31.5 49.5 50T432 386q39 0 70.5-18.5t49-50Q569 286 569 250t-18.5-67.5Q532 151 500 132.5T432 114z'],
        'Meet': [
            'M917.333333 814.933333H106.666667c-36.266667 0-64-27.733333-64-64V192c0-36.266667 27.733333-64 64-64h810.666666c36.266667 0 64 27.733333 64 64v558.933333c0 36.266667-27.733333 64-64 64zM106.666667 170.666667c-12.8 0-21.333333 8.533333-21.333334 21.333333v558.933333c0 12.8 8.533333 21.333333 21.333334 21.333334h810.666666c12.8 0 21.333333-8.533333 21.333334-21.333334V192c0-12.8-8.533333-21.333333-21.333334-21.333333H106.666667z',
            'M512 426.666667c-59.733333 0-106.666667-46.933333-106.666667-106.666667s46.933333-106.666667 106.666667-106.666667 106.666667 46.933333 106.666667 106.666667-46.933333 106.666667-106.666667 106.666667z m0-170.666667c-36.266667 0-64 27.733333-64 64s27.733333 64 64 64 64-27.733333 64-64-27.733333-64-64-64zM682.666667 595.2H341.333333c-6.4 0-12.8-2.133333-17.066666-6.4-4.266667-4.266667-6.4-10.666667-4.266667-17.066667 4.266667-27.733333 21.333333-53.333333 44.8-68.266666 19.2-10.666667 70.4-36.266667 147.2-36.266667 53.333333 0 102.4 12.8 145.066667 36.266667 25.6 14.933333 42.666667 40.533333 44.8 68.266666 0 6.4 0 12.8-4.266667 17.066667-2.133333 4.266667-8.533333 6.4-14.933333 6.4z m-309.333334-42.666667h279.466667c-4.266667-4.266667-8.533333-8.533333-14.933333-12.8-36.266667-19.2-78.933333-29.866667-125.866667-29.866666-66.133333 0-108.8 21.333333-125.866667 29.866666l-12.8 12.8zM746.666667 896H277.333333c-12.8 0-21.333333-8.533333-21.333333-21.333333s8.533333-21.333333 21.333333-21.333334h469.333334c12.8 0 21.333333 8.533333 21.333333 21.333334s-8.533333 21.333333-21.333333 21.333333zM256 704H170.666667c-12.8 0-21.333333-8.533333-21.333334-21.333333s8.533333-21.333333 21.333334-21.333334h85.333333c12.8 0 21.333333 8.533333 21.333333 21.333334s-8.533333 21.333333-21.333333 21.333333zM469.333333 704h-85.333333c-12.8 0-21.333333-8.533333-21.333333-21.333333s8.533333-21.333333 21.333333-21.333334h85.333333c12.8 0 21.333333 8.533333 21.333334 21.333334s-8.533333 21.333333-21.333334 21.333333zM682.666667 704h-85.333334c-12.8 0-21.333333-8.533333-21.333333-21.333333s8.533333-21.333333 21.333333-21.333334h85.333334c12.8 0 21.333333 8.533333 21.333333 21.333334s-8.533333 21.333333-21.333333 21.333333zM874.666667 704h-85.333334c-12.8 0-21.333333-8.533333-21.333333-21.333333s8.533333-21.333333 21.333333-21.333334h85.333334c12.8 0 21.333333 8.533333 21.333333 21.333334s-8.533333 21.333333-21.333333 21.333333z'
        ],
        'Finance': ['M519.314286 416.914286L438.857143 490.057143l-80.457143-73.142857c-14.628571-14.628571-36.571429-14.628571-51.2 0-14.628571 7.314286-14.628571 36.571429 0 51.2l43.885714 43.885714c-14.628571 0-21.942857 14.628571-21.942857 29.257143 0 21.942857 14.628571 36.571429 36.571429 36.571428h36.571428v43.885715H365.714286c-21.942857 0-36.571429 14.628571-36.571429 36.571428s14.628571 36.571429 36.571429 36.571429h36.571428v36.571428c0 21.942857 14.628571 36.571429 36.571429 36.571429s36.571429-14.628571 36.571428-36.571429v-36.571428H512c21.942857 0 36.571429-14.628571 36.571429-36.571429s-14.628571-36.571429-36.571429-36.571428h-36.571429v-43.885715H512c21.942857 0 36.571429-14.628571 36.571429-36.571428 0-14.628571-7.314286-29.257143-21.942858-29.257143l43.885715-43.885714c14.628571-14.628571 14.628571-43.885714 0-51.2-14.628571-14.628571-36.571429-14.628571-51.2 0zM768 219.428571h-658.285714C51.2 219.428571 0 270.628571 0 329.142857v512c0 58.514286 51.2 109.714286 109.714286 109.714286h658.285714c58.514286 0 109.714286-51.2 109.714286-109.714286v-512c0-58.514286-51.2-109.714286-109.714286-109.714286z m36.571429 621.714286c0 21.942857-14.628571 36.571429-36.571429 36.571429h-658.285714c-21.942857 0-36.571429-14.628571-36.571429-36.571429v-512c0-21.942857 14.628571-36.571429 36.571429-36.571428h658.285714c21.942857 0 36.571429 14.628571 36.571429 36.571428v512zM914.285714 73.142857h-658.285714c-21.942857 0-36.571429 14.628571-36.571429 36.571429s14.628571 36.571429 36.571429 36.571428h658.285714c21.942857 0 36.571429 14.628571 36.571429 36.571429v512c0 21.942857 14.628571 36.571429 36.571428 36.571428s36.571429-14.628571 36.571429-36.571428v-512c0-58.514286-51.2-109.714286-109.714286-109.714286z'],
        'Video': [
            'M445.056 596.096h-92.864a86.976 86.976 0 0 1-86.88-86.88v-128.032a86.976 86.976 0 0 1 86.88-86.88h128.032a86.976 86.976 0 0 1 86.88 86.88v91.936a32 32 0 0 1-64 0v-91.936a22.88 22.88 0 0 0-22.88-22.88h-128.032a22.912 22.912 0 0 0-22.88 22.88v128.032c0 12.608 10.272 22.88 22.88 22.88h92.864a32 32 0 0 1 0 64z',
            'M575.616 564.096a37.888 37.888 0 1 1-75.776 0 37.888 37.888 0 1 1 75.776 0z',
            'M537.76 603.968c-21.984 0-39.872-17.888-39.872-39.872s17.888-39.872 39.872-39.872 39.872 17.888 39.872 39.872c0 21.984-17.888 39.872-39.872 39.872z m0-75.744c-19.776 0-35.872 16.096-35.872 35.872s16.096 35.872 35.872 35.872 35.872-16.096 35.872-35.872-16.096-35.872-35.872-35.872z',
            'M735.232 785.408H105.088a102.176 102.176 0 0 1-102.08-102.048V222.08a102.208 102.208 0 0 1 102.08-102.08h459.776a32 32 0 0 1 0 64H105.088c-20.992 0-38.08 17.088-38.08 38.08v461.28a38.08 38.08 0 0 0 38.08 38.048h630.144c20.992 0 38.08-17.088 38.08-38.048v-139.808a32.032 32.032 0 0 1 46.496-28.544l136.96 69.504-1.632-315.712a32 32 0 0 1 31.84-32.16h0.16a32 32 0 0 1 32 31.84l1.92 368.128a31.936 31.936 0 0 1-46.496 28.704l-137.248-69.632v87.68a102.176 102.176 0 0 1-102.08 102.048z',
            'M805.28 395.552a32.032 32.032 0 0 1-32-32V222.08c0-20.992-17.088-38.08-38.08-38.08a32 32 0 0 1 0-64 102.208 102.208 0 0 1 102.08 102.08v88.672l135.008-70.464a31.968 31.968 0 1 1 29.6 56.736l-181.792 94.912a31.872 31.872 0 0 1-14.816 3.616zM235.68 904a32 32 0 0 1-24.128-53.024l96.768-111.2a32.032 32.032 0 0 1 48.288 42.016L259.84 892.992a32 32 0 0 1-24.16 10.976zM624.768 904a32 32 0 0 1-24.16-10.976l-100.16-115.072a32 32 0 1 1 48.288-42.016l100.16 115.072a32 32 0 0 1-24.128 53.024z'
        ],
        'DashBoard': [
            'M924.8 385.6c-22.6-53.4-54.9-101.3-96-142.4-41.1-41.1-89-73.4-142.4-96C631.1 123.8 572.5 112 512 112s-119.1 11.8-174.4 35.2c-53.4 22.6-101.3 54.9-142.4 96-41.1 41.1-73.4 89-96 142.4C75.8 440.9 64 499.5 64 560c0 132.7 58.3 257.7 159.9 343.1l1.7 1.4c5.8 4.8 13.1 7.5 20.6 7.5h531.7c7.5 0 14.8-2.7 20.6-7.5l1.7-1.4C901.7 817.7 960 692.7 960 560c0-60.5-11.9-119.1-35.2-174.4zM761.4 836H262.6C184.5 765.5 140 665.6 140 560c0-99.4 38.7-192.8 109-263 70.3-70.3 163.7-109 263-109 99.4 0 192.8 38.7 263 109 70.3 70.3 109 163.7 109 263 0 105.6-44.5 205.5-122.6 276z',
            'M623.5 421.5c-3.1-3.1-8.2-3.1-11.3 0L527.7 506c-18.7-5-39.4-0.2-54.1 14.5-21.9 21.9-21.9 57.3 0 79.2 21.9 21.9 57.3 21.9 79.2 0 14.7-14.7 19.5-35.4 14.5-54.1l84.5-84.5c3.1-3.1 3.1-8.2 0-11.3l-28.3-28.3zM490 320h44c4.4 0 8-3.6 8-8v-80c0-4.4-3.6-8-8-8h-44c-4.4 0-8 3.6-8 8v80c0 4.4 3.6 8 8 8zM750 538v44c0 4.4 3.6 8 8 8h80c4.4 0 8-3.6 8-8v-44c0-4.4-3.6-8-8-8h-80c-4.4 0-8 3.6-8 8zM762.7 340.8l-31.1-31.1c-3.1-3.1-8.2-3.1-11.3 0l-56.6 56.6c-3.1 3.1-3.1 8.2 0 11.3l31.1 31.1c3.1 3.1 8.2 3.1 11.3 0l56.6-56.6c3.1-3.1 3.1-8.2 0-11.3zM304.1 309.7c-3.1-3.1-8.2-3.1-11.3 0l-31.1 31.1c-3.1 3.1-3.1 8.2 0 11.3l56.6 56.6c3.1 3.1 8.2 3.1 11.3 0l31.1-31.1c3.1-3.1 3.1-8.2 0-11.3l-56.6-56.6zM262 530h-80c-4.4 0-8 3.6-8 8v44c0 4.4 3.6 8 8 8h80c4.4 0 8-3.6 8-8v-44c0-4.4-3.6-8-8-8z'
        ]
    };

    // 更新每个权限的图标
    for (const [name, icon] of Object.entries(iconMap)) {
        const result = await Permission.updateOne(
            { name: name },
            { $set: { icon: icon } }
        );
        if (result.matchedCount > 0) {
            console.log(`✓ 已更新权限 "${name}" 的图标`);
        } else {
            console.log(`✗ 未找到权限 "${name}"`);
        }
    }

    console.log('权限图标更新完成！');
};

// 主函数
const updateIcons = async () => {
    try {
        await connectDB();
        await updatePermissionIcons();
        await mongoose.connection.close();
        console.log('数据库连接已关闭');
        process.exit(0);
    } catch (error) {
        console.error('更新失败:', error);
        process.exit(1);
    }
};

updateIcons();
